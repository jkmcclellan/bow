<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bow is a library for Typed Functional Programming in Swift">
    <meta name="keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="" />
    <meta property="og:title" content="Bow" />
    <meta property="og:site_name" content="Bow" />
    <meta property="og:url" content="https://bow-swift.io" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta property="og:keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bow_swift">
    <meta name="twitter:creator" content="@bow_swift">
    <meta name="twitter:image" content="https://bow-swift.io/img/twitter-card.png" />

    <!-- Bow version metadata -->
    
    <meta name="bow-version" data-title="0.5.0" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/0.5.0/img/favicon.png">
    <!-- Main css -->
    <link rel="stylesheet" type="text/css" href="/0.5.0/css/docs.css">
    <!-- Highlighting css -->
    <link rel="stylesheet" type="text/css" href="/0.5.0/api-docs/css/highlight.css">

    <!-- Code to manage version information -->
    <script src="/0.5.0/js/doc-versions.js" defer></script>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18433785-19"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18433785-19');
</script>

    

</head>

<body id="doc-body">
<div id="wrapper">
    <div id="sidebar-wrapper">
    <div class="sidebar-brand">
        <a class="brand" href="/0.5.0/">
            <img src="/0.5.0/img/icon.svg" alt="Bow logo">
            <span>Bow</span>
        </a>
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <span class="close"></span>
        </button>
    </div>

    <div id="version-dropdown">

    <button class="button link-like" onclick="displayToggle(event)" title="Documentation">
      <span>Bow version</span>
      <span id="bow-version">
        
        0.5.0
      </span>
    </button>

    <ul class="dropdown dropdown-content">

      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/docs">
            <span>
              master
            </span>
        </a>
      </li>

      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/next/docs">
            <span>
              next
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.4.0/docs">
            <span>
              0.4.0
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.5.0/docs">
            <span>
              0.5.0
            </span>
        </a>
      </li>
      
    </ul>
</div>


    <ul class="sidebar-nav">
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Quick start</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/0.5.0/docs/quick-start/getting-started/">
                        <i class="fa fa-circle"></i>
                        <span>Getting started</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/quick-start/modules/">
                        <i class="fa fa-circle"></i>
                        <span>Modules</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/quick-start/resources/">
                        <i class="fa fa-circle"></i>
                        <span>Resources</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>FP concepts</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/0.5.0/docs/fp-concepts/glossary/">
                        <i class="fa fa-circle"></i>
                        <span>Glossary</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/fp-concepts/functions-vs-procedures/">
                        <i class="fa fa-circle"></i>
                        <span>Functions vs Procedures</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/fp-concepts/higher-kinded-types/">
                        <i class="fa fa-circle"></i>
                        <span>Higher Kinded Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/fp-concepts/type-classes/">
                        <i class="fa fa-circle"></i>
                        <span>Type classes</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/fp-concepts/data-types/">
                        <i class="fa fa-circle"></i>
                        <span>Data types</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Patterns</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/0.5.0/docs/patterns/error-handling/">
                        <i class="fa fa-circle"></i>
                        <span>Error handling</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/patterns/dependency-injection/">
                        <i class="fa fa-circle"></i>
                        <span>Dependency injection</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/patterns/polymorphic-programs/">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphic programs</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Optics</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/0.5.0/docs/optics/overview/">
                        <i class="fa fa-circle"></i>
                        <span>Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/optics/writing-your-own-optics/">
                        <i class="fa fa-circle"></i>
                        <span>Writing your own optics</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/optics/automatic-derivation/">
                        <i class="fa fa-circle"></i>
                        <span>Automatic derivation</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/optics/composition/">
                        <i class="fa fa-circle"></i>
                        <span>Composition</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Legal</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/0.5.0/docs/legal/credits/">
                        <i class="fa fa-circle"></i>
                        <span>Credits</span>
                    </a>
                </li>
                
                <li>
                    <a href="/0.5.0/docs/legal/license/">
                        <i class="fa fa-circle"></i>
                        <span>License</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
    </ul>
</div>

    <div id="doc-wrapper">
    <div class="doc-header">
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <i class="fa fa-lg fa-bars menu-icon"></i>
        </button>
    </div>
    <div class="doc-content">
        <h1 id="writing-your-own-optics">Writing your own optics</h1>

<p class="beginner">beginner</p>

<p>In order to work with optics, you need to create them for your specific data type. Consider the following data types:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">PublicationState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">draft</span>
    <span class="k">case</span> <span class="nf">published</span><span class="p">(</span><span class="kt">Date</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Article</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">subtitle</span><span class="p">:</span> <span class="kt">Option</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
    <span class="k">let</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">PublicationState</span>
    <span class="k">let</span> <span class="nv">tags</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can also create some sample values to apply our optics to:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">state</span> <span class="o">=</span> <span class="kt">PublicationState</span><span class="o">.</span><span class="nf">published</span><span class="p">(</span><span class="kt">Date</span><span class="p">())</span>
<span class="k">let</span> <span class="nv">article</span> <span class="o">=</span> <span class="kt">Article</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Working with optics in Swift"</span><span class="p">,</span>
                      <span class="nv">subtitle</span><span class="p">:</span> <span class="o">.</span><span class="nf">some</span><span class="p">(</span><span class="s">"Learn to use BowOptics"</span><span class="p">),</span>
                      <span class="nv">state</span><span class="p">:</span> <span class="o">.</span><span class="n">draft</span><span class="p">,</span>
                      <span class="nv">tags</span><span class="p">:</span> <span class="p">[</span><span class="s">"fp"</span><span class="p">,</span> <span class="s">"swift"</span><span class="p">,</span> <span class="s">"bow"</span><span class="p">])</span>
</code></pre></div></div>

<p>In the following sections, we will describe how to create each of the optics for those types, where they are applicable.</p>

<h2 id="iso">Iso</h2>

<p><code class="highlighter-rouge">Iso&lt;S, A&gt;</code> represents an isomorphism between types <code class="highlighter-rouge">S</code> and <code class="highlighter-rouge">A</code>. That means we can transform from an <code class="highlighter-rouge">S</code> to an <code class="highlighter-rouge">A</code> and back to <code class="highlighter-rouge">S</code> with a pair of functions, and we will get the original value. Similarly, we can start with an <code class="highlighter-rouge">A</code>, transform it to an <code class="highlighter-rouge">S</code> and back to an <code class="highlighter-rouge">A</code> without losing information. This does not mean <code class="highlighter-rouge">S</code> and <code class="highlighter-rouge">A</code> are equal, but it implies their structures are equivalent.</p>

<p>An example of an <code class="highlighter-rouge">Iso</code> can be found in product types. In our running example, <code class="highlighter-rouge">Article</code> is a product type composed of a <code class="highlighter-rouge">String</code>, an optional <code class="highlighter-rouge">String</code>, a <code class="highlighter-rouge">PublicationState</code> and an <code class="highlighter-rouge">Array</code> of <code class="highlighter-rouge">String</code>. But we could also represent the same information using a tuple of 4 elements, and we would be able to get a tuple from an article, and vice versa. That is, we can build an `Iso&lt;Article, (String, Option<String>, PublicationState, [String])&gt;.</String></p>

<p>To do so, we need a pair of functions. To go from tuple to <code class="highlighter-rouge">Article</code>, we can use <code class="highlighter-rouge">Article.init</code>, since the types in the tuple are already in the same order the initializer expects them. To go from <code class="highlighter-rouge">Article</code> to tuple we need to destructure the <code class="highlighter-rouge">Article</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">toTuple</span><span class="p">(</span><span class="n">_</span> <span class="nv">article</span><span class="p">:</span> <span class="kt">Article</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Option</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">PublicationState</span><span class="p">,</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="p">{</span>
    <span class="nf">return</span> <span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">article</span><span class="o">.</span><span class="n">subtitle</span><span class="p">,</span> <span class="n">article</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">article</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this function, creating an <code class="highlighter-rouge">Iso</code> between these types is as easy as:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">iso</span> <span class="o">=</span> <span class="kt">Iso</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Option</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">PublicationState</span><span class="p">,</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">get</span><span class="p">:</span> <span class="n">toTuple</span><span class="p">,</span> <span class="nv">reverseGet</span><span class="p">:</span> <span class="kt">Article</span><span class="o">.</span><span class="kd">init</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Iso</code> initializer expects two functions: <code class="highlighter-rouge">get</code>, to go from <code class="highlighter-rouge">S</code> to <code class="highlighter-rouge">A</code>, and <code class="highlighter-rouge">reverseGet</code> to go from <code class="highlighter-rouge">A</code> to <code class="highlighter-rouge">S</code>, which is exactly what our two functions are doing.</p>

<h4 id="using-iso">Using Iso</h4>

<p>We can transform an article into a tuple with the <code class="highlighter-rouge">iso</code> we just created:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iso</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="c1">// returns ("Working with optics", .some("Learn to use BowOptics"), .draft, ["fp", "swift", "bow"])</span>
</code></pre></div></div>

<p>Or we can make an <code class="highlighter-rouge">Article</code> out of a tuple:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iso</span><span class="o">.</span><span class="nf">reverseGet</span><span class="p">((</span><span class="s">"FP in Swift"</span><span class="p">,</span> <span class="o">.</span><span class="nf">none</span><span class="p">(),</span> <span class="o">.</span><span class="n">draft</span><span class="p">,</span> <span class="p">[]))</span> <span class="c1">// Creates an Article(title: "FP in Swift", subtitle: .none(), state: .draft, tags: [])</span>
</code></pre></div></div>

<h2 id="getter">Getter</h2>

<p><code class="highlighter-rouge">Getter&lt;S, A&gt;</code> allows us to get a value <code class="highlighter-rouge">A</code> out of a structure <code class="highlighter-rouge">S</code>. For instance, we can make a <code class="highlighter-rouge">Getter</code> to extract the <code class="highlighter-rouge">title</code> of an <code class="highlighter-rouge">Article</code>. In that case, we need to make a <code class="highlighter-rouge">Getter&lt;Article, String&gt;</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">titleGetter</span> <span class="o">=</span> <span class="kt">Getter</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span> <span class="p">})</span>
</code></pre></div></div>

<h4 id="using-getter">Using Getter</h4>

<p>As you can guess, we can use a Getter to get a property of a structure. Using the recently created <code class="highlighter-rouge">titleGetter</code>, we can apply it to our <code class="highlighter-rouge">article</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">titleGetter</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="c1">// Returns "Working with optics in Swift"</span>
</code></pre></div></div>

<h2 id="setter">Setter</h2>

<p>Similarly, a <code class="highlighter-rouge">Setter&lt;S, A&gt;</code> allows us to set a new value of type <code class="highlighter-rouge">A</code> or modify the existing one in a structure <code class="highlighter-rouge">S</code>. Since we are dealing with immutable data structures, that involves making a copy of the structure that changes the focused value. We can add the following method to <code class="highlighter-rouge">Article</code> in order to get copies with modified fields seamlessly:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Article</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">copy</span><span class="p">(</span><span class="n">withTitle</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
              <span class="n">withSubtitle</span> <span class="nv">subtitle</span><span class="p">:</span> <span class="kt">Option</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
              <span class="n">withState</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">PublicationState</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
              <span class="n">withTags</span> <span class="nv">tags</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Article</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Article</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="n">title</span> <span class="p">??</span> <span class="k">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                       <span class="nv">subtitle</span><span class="p">:</span> <span class="n">subtitle</span> <span class="p">??</span> <span class="k">self</span><span class="o">.</span><span class="n">subtitle</span><span class="p">,</span>
                       <span class="nv">state</span><span class="p">:</span> <span class="n">state</span> <span class="p">??</span> <span class="k">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                       <span class="nv">tags</span><span class="p">:</span> <span class="n">tags</span> <span class="p">??</span> <span class="k">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This copy method provides multiple overloads to make a copy of the receiver object and modify only certain fields. If an argument is passed, the copy will have it; otherwise, the current value of the object is taken.</p>

<p>Using this, let’s proceed to write a <code class="highlighter-rouge">Setter</code> for the title of an <code class="highlighter-rouge">Article</code>. To create a <code class="highlighter-rouge">Setter</code>, we can pass two closures that specify how an article is modified with a function <code class="highlighter-rouge">f</code> that modifies its title, and how to set a new title for an article. We can write a <code class="highlighter-rouge">Setter&lt;Article, String&gt;</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">titleSetter</span> <span class="o">=</span> <span class="kt">Setter</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">modify</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">f</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="nf">copy</span><span class="p">(</span><span class="nv">withTitle</span><span class="p">:</span> <span class="nf">f</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="p">))</span> <span class="p">},</span>
    <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">newTitle</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="nf">copy</span><span class="p">(</span><span class="nv">withTitle</span><span class="p">:</span> <span class="n">newTitle</span><span class="p">)</span> <span class="p">})</span>
</code></pre></div></div>

<h4 id="using-setter">Using Setter</h4>

<p>Similar to Getter, we can use a Setter to set a property in a structure. Using the <code class="highlighter-rouge">titleSetter</code> created above, we can set a new title for the article we had:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">titleSetter</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="s">"All about Optics"</span><span class="p">)</span> <span class="c1">// Returns Article(title: "All about optics", subtitle: .some("Learn to use BowOptics"), state: .draft, tags: ["fp", "swift", "bow"])</span>
</code></pre></div></div>

<p>It is important to note that the original article remains the same; the Setter creates a copy where all values are the same except the one focused by the Setter.</p>

<p>We don’t have to pass a new value; we can also transform the title of the article:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">titleSetter</span><span class="o">.</span><span class="nf">modify</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span> <span class="n">str</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span> <span class="p">})</span> <span class="c1">// Returns Article(title: "WORKING WITH OPTICS IN SWIFT", subtitle: .some("Learn to use BowOptics"), state: .draft, tags: ["fp", "swift", "bow"])</span>
</code></pre></div></div>

<h2 id="lens">Lens</h2>

<p>If we combine the power of <code class="highlighter-rouge">Getter</code> and <code class="highlighter-rouge">Setter</code> into a single optic, we have a <code class="highlighter-rouge">Lens</code>. A <code class="highlighter-rouge">Lens&lt;S, A&gt;</code> is an optic that lets us get, set or modify a value <code class="highlighter-rouge">A</code> out of a structure <code class="highlighter-rouge">S</code>.</p>

<p>We can provide a Lens to get/set the title of an <code class="highlighter-rouge">Article</code> by providing these two functions:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">titleLens</span> <span class="o">=</span> <span class="kt">Lens</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span> <span class="p">},</span>
    <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">newTitle</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="nf">copy</span><span class="p">(</span><span class="nv">withTitle</span><span class="p">:</span> <span class="n">newTitle</span><span class="p">)</span> <span class="p">})</span>
</code></pre></div></div>

<h4 id="using-lens">Using Lens</h4>

<p>Using Lens is like using Getter and Setter, in the same optic. You can retrieve and modify the focus of the Lens. Using the Lens we just created:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Gets the title</span>
<span class="n">titleLens</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

<span class="c1">// Sets a new title</span>
<span class="n">titleLens</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="s">"All about Optics"</span><span class="p">)</span>

<span class="c1">// Modifies the existing title</span>
<span class="n">titleLens</span><span class="o">.</span><span class="nf">modify</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span> <span class="n">str</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span> <span class="p">})</span>
</code></pre></div></div>

<h2 id="optional">Optional</h2>

<p>In the previous optics, title is always present in an <code class="highlighter-rouge">Article</code>. However, if we focus on its subtitle, we can see it is an <code class="highlighter-rouge">Option&lt;String&gt;</code>. We can still write a <code class="highlighter-rouge">Lens</code> whose focus is <code class="highlighter-rouge">Option&lt;String&gt;</code>, but for the sake of composition, it would be better to remove that optionality.</p>

<p>To do so, we can use the <code class="highlighter-rouge">Optional&lt;S, A&gt;</code>, which lets us focus on a value <code class="highlighter-rouge">A</code> that may be absent in a structure <code class="highlighter-rouge">S</code>, just like the case of the article subtitle. An <code class="highlighter-rouge">Optional</code> needs two functions to be initialized. The setter function just needs to make a copy of the article with the new value. The getter function is a bit trickier. It returns an <code class="highlighter-rouge">Either</code>; if the focus is present in the structure, it returns an <code class="highlighter-rouge">Either.right</code> containing it; otherwise, it returns an <code class="highlighter-rouge">Either.left</code> with the original article.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">subtitleOptional</span> <span class="o">=</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">newSubtitle</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="nf">copy</span><span class="p">(</span><span class="nv">withSubtitle</span><span class="p">:</span> <span class="o">.</span><span class="nf">some</span><span class="p">(</span><span class="n">newSubtitle</span><span class="p">))</span> <span class="p">},</span>
    <span class="nv">getOrModify</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="n">subtitle</span><span class="o">.</span><span class="nf">fold</span><span class="p">({</span> <span class="kt">Either</span><span class="o">.</span><span class="nf">left</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="p">},</span> <span class="kt">Either</span><span class="o">.</span><span class="n">right</span><span class="p">)</span> <span class="p">})</span>
</code></pre></div></div>

<h4 id="using-optional">Using Optional</h4>

<p>Using Optional is quite similar to using a Lens. We can get an Option of the focus or set it to a new value:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">subtitleOptional</span><span class="o">.</span><span class="nf">getOption</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="c1">// Returns .some("Learn to use BowOptics")</span>
<span class="n">subtitleOptional</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="c1">// Returns Article(title: "Working with optics in Swift", subtitle: .some(""), state: .draft, tags: ["fp", "swift", "bow"])</span>
</code></pre></div></div>

<p>If we try to modify an article, it will return a new article with the modified subtitle, or the original article if the subtitle was not present.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">articleWithoutSubtitle</span> <span class="o">=</span> <span class="kt">Article</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Not interesing"</span><span class="p">,</span> <span class="nv">subtitle</span><span class="p">:</span> <span class="o">.</span><span class="nf">none</span><span class="p">(),</span> <span class="nv">state</span><span class="p">:</span> <span class="o">.</span><span class="n">draft</span><span class="p">,</span> <span class="nv">tags</span><span class="p">:</span> <span class="p">[])</span>
<span class="n">subtitleOptional</span><span class="o">.</span><span class="nf">modify</span><span class="p">(</span><span class="n">articleWithoutSubtitle</span><span class="p">,</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span> <span class="n">str</span><span class="o">.</span><span class="nf">lowercased</span><span class="p">()</span> <span class="p">})</span> <span class="c1">// Returns the same article as it does not have a subtitle</span>
</code></pre></div></div>

<h2 id="prism">Prism</h2>

<p>All the optics above work for product types. When it comes to sum types, we need to use <code class="highlighter-rouge">Prism</code>. <code class="highlighter-rouge">Prism&lt;S, A&gt;</code> is an optic that lets us focus on a value <code class="highlighter-rouge">A</code> that is present under certain circumstances in the structure <code class="highlighter-rouge">S</code>.</p>

<p>Sum types in Swift are usually represented by <code class="highlighter-rouge">enum</code>, so focusing on one of the cases does not guarantee that it is always going to be there.</p>

<p>As an example, consider the <code class="highlighter-rouge">PublicationState</code> described above. If we want to focus on the published side and get the <code class="highlighter-rouge">Date</code> of publication, we need to create a <code class="highlighter-rouge">Prism&lt;PublicationState, Date&gt;</code>. As usual, we need two functions. The getter lets us get <code class="highlighter-rouge">Either</code> the date (<code class="highlighter-rouge">right</code>, if we received a <code class="highlighter-rouge">PublicationState</code> that is in the state we are focusing) or the original state (<code class="highlighter-rouge">left</code>, if we are in another case of the <code class="highlighter-rouge">PublicationState</code>). The other function lets us build a state from a given <code class="highlighter-rouge">Date</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">publishedPrism</span> <span class="o">=</span> <span class="kt">Prism</span><span class="o">&lt;</span><span class="kt">PublicationState</span><span class="p">,</span> <span class="kt">Date</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">getOrModify</span><span class="p">:</span> <span class="p">{</span> <span class="n">state</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">published</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">Either</span><span class="o">.</span><span class="nf">left</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kt">Either</span><span class="o">.</span><span class="nf">right</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="p">},</span> <span class="nv">reverseGet</span><span class="p">:</span> <span class="kt">PublicationState</span><span class="o">.</span><span class="n">published</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="using-prism">Using Prism</h4>

<p>We can use the Prism above to get the publication date from a state:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">publishedPrism</span><span class="o">.</span><span class="nf">getOption</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="c1">// Returns an Option with the date that we set when we created it</span>
</code></pre></div></div>

<p>However, in the case of a <code class="highlighter-rouge">PublishedState.draft</code>, this Prism cannot get a Date, so it will return an empty Option:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">publishedPrism</span><span class="o">.</span><span class="nf">getOption</span><span class="p">(</span><span class="o">.</span><span class="n">draft</span><span class="p">)</span> <span class="c1">// Returns .none()</span>
</code></pre></div></div>

<h2 id="fold">Fold</h2>

<p>The optics presented so far have only one focus. Is it possible to have multiple foci? The <code class="highlighter-rouge">Fold</code> and <code class="highlighter-rouge">Traversal</code> optics have 0 to n foci.</p>

<p><code class="highlighter-rouge">Fold</code> is a generalization of <code class="highlighter-rouge">Foldable</code>. <code class="highlighter-rouge">Fold&lt;S, A&gt;</code> describes an optic that can focus on several <code class="highlighter-rouge">A</code> values in a structure <code class="highlighter-rouge">S</code> and can transform and fold them into a summary value.</p>

<p>This is usually the case of fields that contain collections of elements and we want to focus on them individually. In the case of <code class="highlighter-rouge">Article</code>, if we write a <code class="highlighter-rouge">Lens</code> for the tags, it lets us focus on all tags as a whole, not on each individual tag.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">tagsLens</span> <span class="o">=</span> <span class="kt">Lens</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="n">tags</span> <span class="p">},</span>
    <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">newTags</span> <span class="k">in</span> <span class="n">article</span><span class="o">.</span><span class="nf">copy</span><span class="p">(</span><span class="nv">withTags</span><span class="p">:</span> <span class="n">newTags</span><span class="p">)</span> <span class="p">})</span>
</code></pre></div></div>

<p>We can get a <code class="highlighter-rouge">Fold&lt;Article, String&gt;</code> that lets us have foci to each individual tag. In this case, we can leverage an existing <code class="highlighter-rouge">Fold&lt;[A], A&gt;</code>; i.e. for any array, it gives us a <code class="highlighter-rouge">Fold</code> to focus on each item of the array. It is available in <code class="highlighter-rouge">Array&lt;Element&gt;.fold</code>. With that, we can compose it with the <code class="highlighter-rouge">tagsLens</code> to get a <code class="highlighter-rouge">Fold</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">tagsFold</span><span class="p">:</span> <span class="kt">Fold</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">tagsLens</span> <span class="o">+</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;.</span><span class="n">fold</span>
</code></pre></div></div>

<h4 id="using-fold">Using Fold</h4>

<p>Once we have a Fold, we can use it for different purposes, like counting the number of tags:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tagsFold</span><span class="o">.</span><span class="nf">size</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="c1">// Returns 3</span>
</code></pre></div></div>

<p>Or find a tag with a specific criteria:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tagsFold</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="p">{</span> <span class="n">tag</span> <span class="k">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">})</span> <span class="c1">// Returns .some("fp")</span>
</code></pre></div></div>

<h2 id="traversal">Traversal</h2>

<p>Finally, <code class="highlighter-rouge">Traversal</code> is a generalization of <code class="highlighter-rouge">Traverse</code>. <code class="highlighter-rouge">Traversal&lt;S, A&gt;</code> lets us focus on multiple <code class="highlighter-rouge">A</code> values in a structure <code class="highlighter-rouge">S</code> to get, set or modify them. Like in the case for <code class="highlighter-rouge">Fold</code>, it is useful for fields that contain collections of elements. Likeways, there is a <code class="highlighter-rouge">Traversal&lt;[A], A&gt;</code> available for any array in <code class="highlighter-rouge">Array&lt;Element&gt;.traversal</code>. With that, we can compose it with the <code class="highlighter-rouge">tagsLens</code> to get a <code class="highlighter-rouge">Traversal</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">tagsTraversal</span><span class="p">:</span> <span class="kt">Traversal</span><span class="o">&lt;</span><span class="kt">Article</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">tagsLens</span> <span class="o">+</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;.</span><span class="n">traversal</span>
</code></pre></div></div>

<h4 id="using-traversal">Using Traversal</h4>

<p>The Traversal for tags that we have created lets us modify all of them with a function:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tagsTraversal</span><span class="o">.</span><span class="nf">modify</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span> <span class="n">str</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span> <span class="p">})</span> <span class="c1">// Uppercases all tags</span>
</code></pre></div></div>

<p>Or check if there is a tag that matches a predicate:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tagsTraversal</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span> <span class="n">str</span> <span class="o">==</span> <span class="s">"advanced"</span> <span class="p">})</span> <span class="c1">// Returns false as the article does not have any "advanced" tag</span>
</code></pre></div></div>

<p>There are many more operations that are available for each optic that the ones shown in this page. For a complete reference, check the API documentation for each optic.</p>

    </div>
</div>

</div>
<!-- Custom scripts for this template -->
<script src="/0.5.0/js/docs.js"></script>
<!-- Gitter -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'bowswift/bow'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

</body>
</html>
